#include "FreeRTOS_AVR.h"

#define LEDPIN 11
#define SENSORPIN A1

SemaphoreHandle_t mutex1;

int val;

void InputLight(void *pvParameters) {
  for (;;)  {
    xSemaphoreTake(mutex1, portMAX_DELAY);

    val = 0;
    val = analogRead(SENSORPIN);

    if (val > 100)    {
      xSemaphoreGive(mutex1);
      Serial.println(val);
    } else {
      Serial.println(val);
    }

    vTaskDelay(100);
  }
}


void LEDTask(void *pvParameters) {
  for (;;) {
    xSemaphoreTake(mutex1, portMAX_DELAY);

    digitalWrite(LEDPIN, HIGH);
    Serial.println("LED ON");

    vTaskDelay(500);

    digitalWrite(LEDPIN, LOW);
    Serial.println("LED OFF");
    
    xSemaphoreGive(mutex1);
    vTaskDelay(100);
  }
}


void setup() {
  // put your setup code here, to run once:
  Serial.begin(9600);
  pinMode(LEDPIN, OUTPUT);

  mutex1 = xSemaphoreCreateBinary();

  xTaskCreate(InputLight, NULL, configMINIMAL_STACK_SIZE, NULL, 2, NULL);
  xTaskCreate(LEDTask, NULL, configMINIMAL_STACK_SIZE, NULL, 1, NULL);
  vTaskStartScheduler();
  
  while (1);
}
void loop() {
  // put your main code here, to run repeatedly:
}
